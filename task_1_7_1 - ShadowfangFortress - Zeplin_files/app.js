!function(){"use strict";function e(){fetch(Zeplin.urls.baseURL+"/users/emailNotifications",{method:"PUT",headers:Zeplin.headers,body:JSON.stringify({emailNotifications:u.checked})}).then(function(e){return e.ok?void 0:e.json().then(function(t){throw Zeplin.createError(e.status,t)})}).then(function(){i.emailNotifications=u.checked,localStorage.setItem("user",JSON.stringify(i))})["catch"](function(e){console.error(e),u.checked=!u.checked,e instanceof ServerError?Zeplin.createDialog({title:e.title,message:e.message}):e instanceof ClientError?Zeplin.createDialog({title:e.title,message:e.message,done:{name:"OK",cb:function(){401===e.status&&(Cookies.expire("userToken"),localStorage.removeItem("user"),sessionStorage.setItem("redirectTo",location.href),location.replace("login.html"))}}}):Zeplin.createDialog()})}function t(){Cookies.expire("userToken"),localStorage.removeItem("user"),location.replace("login.html")}if(!Cookies.get("userToken"))return sessionStorage.setItem("redirectTo",location.href),location.replace("login.html");window.Zeplin.projectTypes=Object.freeze({android:"Android",ios:"iOS",osx:"Mac OS X",web:"Web"});var n;window.Zeplin.getPlans=function(){return n?Promise.resolve(n):fetch(Zeplin.urls.baseURL+"/api/plans").then(function(e){return e.json().then(function(t){if(e.ok)return t.plans;throw Zeplin.createError(e.status,t)})})},Zeplin.setGravatar=function(e,t,n){function i(t){t&&e.removeEventListener("error",i),e.src="img/icPopupProfile.svg",e.removeAttribute("srcset")}if(!t)return void i();var o=e.width;n&&"size"in n&&(o=n.size);var r="https://secure.gravatar.com/avatar/"+md5(t);e.addEventListener("error",i),e.src=r+"?s="+o+"&d=404",e.srcset=r+"?s="+2*o+"&d=404 2x"};var i,o=document.getElementById("currentUser"),r=document.getElementById("userMenu"),s=document.getElementById("notificationContainer"),a=document.getElementById("verificationBanner"),c=document.getElementById("notificationBanner"),d=document.getElementById("notificationBannerCloseButton"),l=document.getElementById("notificationStatusCheckbox"),u=document.getElementById("emailNotificationStatusCheckbox"),f=document.getElementById("logoutButton");window.Notification?(l.addEventListener("change",function(){return"denied"===Notification.permission?(l.checked=!1,void Zeplin.createDialog({message:"You need to enable notifications from browser settings."})):"default"===Notification.permission&&l.checked?void Notification.requestPermission(function(e){Zeplin.userPrefs.set("notificationStatus","granted"===e).then(function(e){l.checked=e})}):void Zeplin.userPrefs.set("notificationStatus",l.checked)}),c&&Zeplin.userPrefs.get("notificationBannerStatus").then(function(e){"default"===Notification.permission&&e&&(c.addEventListener("click",function(){c.classList.add("hidden"),Notification.requestPermission(function(e){Zeplin.userPrefs.set("notificationStatus","granted"===e).then(function(e){l.checked=e})})}),d.addEventListener("click",function(e){e.stopPropagation(),Zeplin.userPrefs.set("notificationBannerStatus",!1),c.classList.add("hidden")}),c.classList.remove("hidden"))})):l.parentElement.parentElement.classList.add("hidden");var m;u.addEventListener("change",function(){clearTimeout(m),m=setTimeout(function(){e()},1e3)}),o.addEventListener("click",function(e){e.stopPropagation(),e.button===Zeplin.MOUSE_BUTTON.LEFT&&(window.Notification&&r.classList.contains("hidden")&&("granted"!==Notification.permission?(Zeplin.userPrefs.set("notificationStatus",!1),l.checked=!1):Zeplin.userPrefs.get("notificationStatus").then(function(e){l.checked=e})),s.classList.add("hidden"),r.classList.toggle("hidden"))}),r.addEventListener("click",function(e){e.stopPropagation()}),f.addEventListener("click",function(e){e.button===Zeplin.MOUSE_BUTTON.LEFT&&(mixpanel.track("Logged out"),fetch(Zeplin.urls.baseURL+"/users/logout",{method:"POST",headers:Zeplin.headers}).then(t,t))}),document.addEventListener("click",function(e){e.button===Zeplin.MOUSE_BUTTON.LEFT&&r.classList.add("hidden")}),document.addEventListener("keydown",function(e){e.keyCode===Zeplin.KEY_CODE.ESC&&r.classList.add("hidden")}),window.Zeplin.pusher=new Pusher("2f5176ab06dc15ac99da",{disableFlash:!0,encrypted:!0,authEndpoint:Zeplin.urls.baseURL+"/pusher/auth",auth:{headers:{"Zeplin-Token":Cookies.get("userToken")}}}),Zeplin.pusher.connection.bind("connected",function(){Zeplin.headers.set("Zeplin-Socket-Id",Zeplin.pusher.connection.socket_id)}),window.addEventListener("storage",function(e){if(e.storageArea===localStorage&&"user"===e.key){var t=JSON.parse(e.oldValue),n=JSON.parse(e.newValue);if(!n)return;if(Zeplin.user=n,i=n,t._id!==n._id)return location.reload();"registered"===n.status&&(r.querySelector(".userStatus").textContent="Not verified yet.")}}),Zeplin.userInfoPromise=Zeplin.getUserInfo().then(function(e){i=e,"Intercom"in window&&Intercom("boot",{app_id:"41ycdg94",user_id:e._id,email:e.email,last_seen_user_agent:navigator.userAgent,"last seen at web":Math.floor(Date.now()/1e3)}),Zeplin.setGravatar(r.querySelector(".profileImage"),e.email,{size:64}),Zeplin.setGravatar(o.querySelector(".profileImage"),e.email,{size:36}),o.title=e.username,r.querySelector(".username").textContent=e.username,r.querySelector(".email").textContent=e.email,u.checked=void 0===e.emailNotifications||e.emailNotifications,"registered"===e.status&&(r.querySelector(".userStatus").textContent="Not verified yet.",a&&"dismissed"!==sessionStorage.getItem("verificationBannerStatus")&&(a.classList.remove("hidden"),document.getElementById("verificationBannerCloseButton").addEventListener("click",function(e){e.stopPropagation(),a.classList.add("hidden"),sessionStorage.setItem("verificationBannerStatus","dismissed")})));var t=Zeplin.pusher.subscribe("private-user@"+e._id);return t.bind("UpdateUsername",function(t){var n=t.body.username;e.username=n,o.title=n,r.querySelector(".username").textContent=n,localStorage.setItem("user",JSON.stringify(e))}),t.bind("UpdateEmail",function(t){var n=t.body.email;e.email=n,r.querySelector(".email").textContent=n,localStorage.setItem("user",JSON.stringify(e))}),t.bind("VerifyUser",function(){e.status="verified",r.querySelector(".userStatus").textContent="",localStorage.setItem("user",JSON.stringify(e))}),t.bind("UpdateEmailNotifications",function(t){var n=t.body.emailNotifications;u.checked=n,e.emailNotifications=n,localStorage.setItem("user",JSON.stringify(e))}),t.bind("UpdateBilling",function(t){e.billing=e.billing||{},void 0!==t.body.email&&(e.billing.email=t.body.email),void 0!==t.body.extraInfo&&(e.billing.extraInfo=t.body.extraInfo),localStorage.setItem("user",JSON.stringify(e))}),e})}();